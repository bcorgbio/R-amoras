---
title: "Final Project - Remoras"
author: "R-amoras"
date: "2022-12-12"
output: html_document
---

```{r, packages, include=FALSE}
library(tidyverse)
library(trackter)
```

# Introduction


# Methods

For this project, the main methodology involved three parts: feeding, video analysis, and statistical analysis. A Remora was left without food for about 5 days. Next, a camera was set and it recorded the subsequent feeding events. A small piece of shrimp was dropped in the tank and videos where the full side of the fish was visible for the whole feeding event were kept. The videos were clipped to only include frames from the feeding event. Next, there videos were uploaded to Fiji and a plugin called mtrack was used to place points on each frame of the video. Five points were place: one on the tip of the top jaw (1), one on the tip of the bottom jaw (2), one on the joint of the pectoral fin (3), one on the joint of the pelvic fin(4), and one at the lowest point on the fish’s gullet(5), labeled in this order. The data was loaded into R and distances were measured from points 1 to 2, 2 to 3, 3 to 4, and 3 to 5. These distances were used to calculate the change in angle to determine how much the mouth opened for the duration of the feeding event. We looked at the decrease in the angle of the lower jaw to see how much farther down it moved, the increase in angle of the upper jaw to see how much farther up it moved, and the distance between the top and bottom jaw to see how much it opened it’s mouth. 


```{r, setup, include=FALSE}
videos <- list.files(pattern="csv")

data <- list()
for(i in videos){
  exp <- gsub("Ram_vid(\\d)points.csv","\\1",i) %>% as.numeric
  d <- read_csv(i) %>% 
    select(TID,PID,`x [pixel]`,`y [pixel]`) %>% 
    rename(point=TID,frame=PID,x=`x [pixel]`,y=`y [pixel]`) %>% 
    pivot_wider(names_from = "point", values_from=c("x","y")) %>% 
    mutate(d23=dist.2d(x_1,x_3,y_1,y_3),
           d34=dist.2d(x_3,x_4,y_3,y_4),
           gap=dist.2d(x_1,x_2,y_1,y_2),
           d42=dist.2d(x_4,x_1,y_4,y_1)) %>%
    na.omit %>% 
    group_by(frame) %>% 
    mutate(CE_alpha=deg(cosine.ang(d23,d34,d42))) %>% 
    ungroup() %>% 
    mutate(CE_alpha2=CE_alpha-first(CE_alpha,1)) %>% 
    mutate(hy_exp=dist.2d(x_5,x_5,y_3,y_5)/dist.2d(x_1,x_3,y_1,y_3)) %>% 
    mutate(hy_exp2=abs(hy_exp-first(hy_exp,1))) %>% 
    mutate(exp=exp)
  
  data[[i]] <- d
}


data2 <- do.call(rbind,data)

```

# Results

## Cranial Elevation

```{r cranial, echo=FALSE}
data2 %>% 
  ggplot(aes(frame,CE_alpha2,col=as.factor(exp)))+geom_point()+ guides(color = guide_legend(title = "Trials"))+labs(y = "Cranial Elevation (\u00B0)")

data2 %>% 
  ggplot(aes(frame,CE_alpha2,col=as.factor(exp)))+geom_point()+ guides(color = guide_legend(title = "Trials"))+facet_wrap(~exp)+labs(y = "Cranial Elevation (\u00B0)")
```

## Hyoid Expansion
```{r hyoid, echo=FALSE}
data2 %>% 
  ggplot(aes(frame,hy_exp2,col=as.factor(exp)))+geom_point()+ guides(color = guide_legend(title = "Trials"))+labs(y = "Hyoid Expansion")

data2 %>% 
  ggplot(aes(frame,hy_exp2,col=as.factor(exp)))+geom_point()+ guides(color = guide_legend(title = "Trials"))+facet_wrap(~exp)+labs(y = "Hyoid Expansion")

```

## Summary

```{r summary, echo=FALSE}
data2 %>% 
  group_by(exp) %>% 
  summarize(CE_alpha2=diff(range(CE_alpha2)),hy_exp2=diff(range(hy_exp2)),gap=diff(range(gap)))
```

For each trial, we witnessed an angle increase between the pectoral fin joint, the tip of the upper jaw, and the pelvic fin joint as the jaw began to open. The largest angle was where the top jaw was opened the widest. The difference between this largest angle and the “ resting closed mouth” angle measured which we marked as the first angle angle, was 33.5, 47.2, 36.3, 43.1, and 37.6 respectively for trials 1-5. On average, this fish had a maximum cranial elevation angle of 39.54. Additionally, the hyoid expansion, had on average an increase of 8.76 % of the head length. 

# Discussion


## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
